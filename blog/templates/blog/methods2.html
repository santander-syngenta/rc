{% extends 'blog/main.html' %}
{% load static %}
{% block content %}


<style>
	h3{
		color:#482e61;
		text-decoration: underline;
		text-decoration-color:#8d8299;
		padding-left: 1%;
	}
	.custom{
		width: auto;
		background-color: #fff;
		justify-content: center;
		display: flex;
		background-color: #829986;
		color:white;
		border-radius: 25px;
		border-color: #fff;
		border-width: 4px;
		padding-bottom: 0px;
		text-align: center;
		border: 2px solid #8d8299;
	}
	.title, .date{
		font-family: 'Montserrat', sans-serif;
		color:#343a40 !important;
	}
	#form_wrapper{
		display: table;
	}
	#custom{
		background-color: #fff;
		text-align: center;
		float:left;
		border: 2px solid #8d8299;
	}
	.main{
		width:95%;
		justify-content: center;
		border: 2px solid #8d8299;
	}
	.row1{
		background-color: #e7f2d0;
	}
	/* Track */
	.style-15::-webkit-scrollbar
	{
		background-color:#e7f2d0;
	}

	.style-15::-webkit-scrollbar-thumb
	{
		border-radius:5px;
		background-color: #418c42;	
		background-image: -webkit-linear-gradient(45deg,
	                                          rgba(255, 255, 255, .2) 25%,
											  transparent 25%,
											  transparent 50%,
											  rgba(255, 255, 255, .2) 50%,
											  rgba(255, 255, 255, .2) 75%,
											  transparent 75%,
											  transparent)
	}
	.style-15::-webkit-scrollbar-track {
    	box-shadow: inset 0 0 10px 10px #8d8299;
    	border: solid 3px transparent;
	}
	.head{
		padding-top:.5rem;
		padding-left: 3rem;
		padding-right: 3rem;

	}
</style>
<hr>
<div class="row" style="line-height: 70%">
	<div class="column custom mx-auto">
		<div class="custom card card-body head shadow" style="line-height: 70%">
			<h2>Field Methodology</h2>
			<p>Share & Learn Ways of Working</p>
		</div>
	</div>
</div>
<br/>
<div id='main'> 



</div>


<script type="text/javascript">
	var list = null;
	var tags = [];
	var tagNames = {};

	function startBuild(){
		var url = 'http://127.0.0.1:8080/api/form-list/'
		fetch(url)
		.then((resp) => resp.json())
		.then(function(data){
			list = data;
			getTagNames();
		})
	}
	startBuild();

	function getTagNames(){
		var url = 'http://127.0.0.1:8080/api/tag-list/'
		fetch(url)
		.then((resp) => resp.json())
		.then(function(data){
			tagNames = data;
			buildTags();
		})
	}

	function buildTags(){
		for (var i in list){
			for (var j in list[i].tag){
				var tag = list[i].tag[j];
				var n = tags.includes(tag)
				if (n == false){
					tags.push(list[i].tag[j])
				}
			}
		}
		for (var i = 0; i < tags.length; i++){
			var main = document.getElementById('main');
			var row = 	`
				<div class="card card-body main mx-auto row1 shadow" id="${i}">
					<div class="row row1 style-15" style="overflow-x: scroll; overflow-y: hidden; white-space: nowrap;" id="${i}">
						<span id="form-wrapper-${i}" style="display:inline;">
						<h3>Related to: ${tagNames[i].name}</h3>

						</span>
					</div>
				</div>
				<br/>`;
			main.innerHTML += row;
			buildList(i);
		}
	}

	function buildList(j){
		var tag = tags[j];
		console.log(tag);
		for (var i in list){
			var formTags = list[i].tag;
			if (formTags.includes(tag)){
				var wrapper = document.getElementById(`form-wrapper-${j}`);
				var href1 = "http://127.0.0.1:8080/display/" + list[i].id;
				var src = "http://127.0.0.1:8080/static" + list[i].file;
				var type = src.type;
				var title = `<span style="display:block; text-align:center"><a class="title" href=${href1}>${list[i].title}</a></span>`;
				console.log(title);
				var date = `<span style="display:block; text-align:center"><a class="date" href=${href1}>Uploaded: ${list[i].date}</a></span>`;
				var item = `
					<div id="card mx-auto custom" style="display:inline-block">
						<span><iframe class="iframe" id='file' src=${src}></iframe></span>
						${title}
						${date}
					</div>
				`;
				wrapper.innerHTML += item;
			} else {
				console.log('Fail: ', tag, list[i])
			}

		}
	}
</script>



{% endblock %}