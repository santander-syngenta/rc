{% extends 'blog/main.html' %}
{% load static %}
{% block content %}

<style type="text/css">
	body{
		overflow-y: scroll;
	}
	.container{
		max-width: 85%;
		padding-left: 0;
		padding-right:0;
		margin:0;
		justify-content: center;
	}
	.href{
		border: 2px solid #526927;
		text-align: center;
		margin-top: 1em;
		border-radius:15px;
	}
	.img{
		min-width: 100%;
		border-radius: 15px;
	}
	.custom{
		width: auto;
		justify-content: center;
		display: flex;
		background-color: #526927;
		color:white;
		border-radius: 15px;
		text-decoration: underline;
		border-color: #fff;
		border-width: 2px;
	}
	.head{
		padding-top:.25em;
		padding-left: 8em;
		padding-right: 8em;
		padding-bottom: 0em;
		text-align: center;
	}
	h3{
    	font-family: Rockwell, "Courier New", Courier, Georgia,
                 Times, "Times New Roman", serif;
    	text-decoration: underline;
	}
	button{
		padding:0;
	}
	#content_wrapper{
		display: table;
		justify-content: center;
	}
	.main{
		width:95%;
		justify-content: center;
		border: 2px solid #2e612f;
		padding-top:.5em;
		background-color: #fafff0;
		margin:auto;
	}
	.scroll::-webkit-scrollbar
	{
		background-color:#fafff0;
	}

	.scroll::-webkit-scrollbar-thumb
	{
		border-radius:5px;
		background-color: #526927;	
		background-image: -webkit-linear-gradient(45deg,rgba(255, 255, 255, .2) 25%, transparent 25%,transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent)
	}
	.scroll::-webkit-scrollbar-track {
    	box-shadow: inset 0 0 10px 10px #d5dec5;
    	border: solid 5px transparent;
	}
	.scroll{
		overflow-x: scroll;
		overflow-y: hidden;
		white-space: nowrap;
	}
	span > h3{
		color:black;
		padding-left:2rem;
		font-weight: 700;
	}
	.title, .date{
		font-family: 'Montserrat', sans-serif;
		color:#343a40 !important;
	}
	.title{
		font-weight: 700;
	}
	.doc{
		display:inline-block;
		border:.5px solid black;
		text-align:center;
		background-color:#fff;
		margin:4px;
	}
	iframe > html {
		overflow: hidden;
	}
	.carousel.inner {
		justify-content: center;
	}
	.carousel2{
		justify-content: center;
		width:45%;
		border-radius: 10px;
		border: 3px solid  #829986;
	}
</style>
<hr>
<div class="row">
	<div class="column custom mx-auto">
		<div class="custom card card-body head shadow">
			<h3>Learning</h3>
		</div>
	</div>
</div>
<div class = "container mx-auto">
	<div class = "row">
		<div class = "col">
			<button class="href shadow subject" id="BioAnalytics">
				<span>
					<img src = "{% static 'images/bioanalytics.png' %}" class = "img img-fluid mx-auto d-block">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="BioBalance">
				<span>
					<img src = "{% static 'images/biobalance.png' %}" class = "img img-fluid mx-auto d-block">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="BioDesign">
				<span>
					<img src = "{% static 'images/biodesign.png' %}" class = "img img-fluid mx-auto d-block">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="BioHome">
				<span>
					<img src = "{% static 'images/biohome.png' %}" class = "img img-fluid mx-auto d-block" style="border:1;">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="ARM">
				<span>
					<img src = "{% static 'images/arm2.png' %}" class = "img img-fluid mx-auto d-block" style="border:1;">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="Regional Applications">
				<span>
					<img src = "{% static 'images/regional.png' %}" class = "img img-fluid mx-auto d-block" style="border:1;">
				</span>
			</button>
		</div>
		<div class = "col">
			<button class="href shadow subject" id="Electronic Data Capture">
				<span>
					<img src = "{% static 'images/edc.png' %}" class = "img img-fluid mx-auto d-block" style="border:1;">
				</span>
			</button>
		</div>
	</div>
</div>
<br>
<div id="main">
	<div class = "card card-body mx-auto carousel2">
		<div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
			<div class="carousel-inner">
				<div class="carousel-item active">
					<img class="d-block w-100" src="{% static 'images/bitslogos.png' %}" alt="First slide">
				</div>
				<div class="carousel-item">
					<img class="d-block w-100" src="{% static 'images/bitslogos2.png' %}" alt="Second slide">
				</div>
			</div>
			<a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			</a>
			<a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			</a>
		</div>
	</div>
</div>


<script type="text/javascript">
	var allData = null;
	var subjects = null;
	getData();

	var buttons = document.getElementsByClassName('subject');
	for (var i=0; i<buttons.length; i++){
		buttons[i].addEventListener('click', function(e){
			buildTag(this.id);
		})
	}

	function buildTag(subject){
		console.log('Building for: ', subject);
		var page = document.getElementById('main');
		page.innerHTML = '';
		content = `
			<br>
			<div class="card card-body main mx-auto shadow">
				<div class="row scroll" id="contentDiv">
					<span id="content-wrapper" style="display:inline;">
						<h3>${subject}</h3>
					</span>
				</div>
			</div>
		`
		page.innerHTML += content;
		renderContent(subject);
	}


	function renderContent(subject){
		var subjectId = null;
		var wrapper = document.getElementById('content-wrapper')
		var newSubject = null;
		if (subject === 'Regional Applications'){
			newSubject = 'RegionalApps';
		} else {
			if (subject === 'Electronic Data Capture'){
				newSubject = 'EDC'
			} else {
				newSubject = subject;
			}
		}
		for (var i = 0; i < subjects.length; i++){
			if (subjects[i].name === newSubject){
				subjectId = subjects[i].id;
			}
		}
		for (var i = 0; i < allData.length; i++){
			if (allData[i].subject[0] === subjectId){
				var href1 = null;
				if (allData[i].file2 != null){
					href1 = "http://172.20.57.135:88/display4/" + allData[i].id;
				} else {
					href1 = "http://172.20.57.135:88/display2/" + allData[i].id;
				}
				var src = "http://172.20.57.135:88/static" + allData[i].file;
				var file = allData[i].file;
				var fileType = file.substring(file.length - 3, file.length);
				var date = new Date(allData[i].date);
				var adjusted = date.toDateString();
				if (fileType === 'pdf'){
					var title = `<span style="display:block; text-align:center"><a class="title" href=${href1}>${allData[i].title}</a></span>`;
					var date = `<span style="display:block; text-align:center"><a class="date" href=${href1}>Uploaded: ${adjusted.substr(adjusted.indexOf(' ') + 1)}</a></span>`;
					var item = `
						<div class="doc">
							<span><iframe class="iframe" id='file' src=${src}></iframe></span>
							${title}
							${date}
						</div>
					`;
				} else { 
					var title = `<span style="display:block; text-align:center"><a class="title" href=${href1}>${allData[i].title}</a></span>`;
					var date = `<span style="display:block; text-align:center"><a class="date" href=${href1}>Uploaded: ${allData[i].date}</a></span>`;
					var item = `
						<div id="card mx-auto custom" style="display:inline-block;border:.5px solid black;text-align:center;background-color:#fff;margin:4px;">
							<span><video height="150">
								<source src=${src} type="video/mp4">
							</video></span>
							${title}
							${date}
						</div>
					`;
				}
				wrapper.innerHTML += item;
			}
		}
	}


	function getData(){
		fetch('http://172.20.57.135:88/api/content-list/')
		.then((resp) => resp.json())
		.then(function(data){
			allData = data;
		})
		.then(function(){
			console.log(allData)
			getSubjects();
		})
	}


	function getSubjects(){
		fetch('http://172.20.57.135:88/api/subject-list/')
		.then((resp) => resp.json())
		.then(function(data){
			subjects = data;
		})
	}
</script>

{% endblock %}

<iframe src="https://syngenta.sharepoint.com/sites/BDATeam/_layouts/15/Doc.aspx?sourcedoc={d38ad65a-7b17-41d8-8dc1-97d93a423cbd}&amp;action=embedview&amp;wdAr=1.3333333333333333" width="350px" height="286px" frameborder="0">This is an embedded <a target="_blank" href="https://office.com">Microsoft Office</a> presentation, powered by <a target="_blank" href="https://office.com/webapps">Office</a>.</iframe>